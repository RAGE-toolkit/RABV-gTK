

conda.enabled = true



// -------------------------------------------------
//  1. SHARED / DEFAULT PARAMETERS
// -------------------------------------------------
// These are the defaults used if not overwritten by a specific profile.
// Useful for directory structures or fallbacks.

params {
    // Pipeline Defaults
    publish_dir     = "results"
    email           = "your_email@example.com"
    xml_dir         = null
    update_file     = null
    
    
    // Logic Defaults (Safety fallbacks)
    extra_info_fill = false
    is_segmented    = "N"
    is_flu          = "N"

    // MMseqs defaults (threads only)
    mmseqs_threads    = 1
    test_max_cluster_seqs = null
    
    // Empty placeholders for required inputs
    // This ensures the pipeline fails with a clear error if
    // a user forgets to specify a profile or input params.
    tax_id            = null
    db_name           = null
    ref_list          = null
    bulk_fillup_table = null
    gene_info         = null
    update            = null
    gisaid_dir        = null
    previous_db       = null // For excluding already processed accessions in GISAID update (optional)
    conda_path        = null
    scripts_dir       = "${projectDir}/scripts"
}

// -------------------------------------------------
//  2. PROFILES
// -------------------------------------------------
// specific configurations for different run modes

profiles {

    // The 'standard' profile is used if no flag is provided
    standard {
        process.executor = 'local'
    }

    conda{
        conda.enabled = true
       try {
            def detected_path = "which conda".execute().text.trim()
            conda.cmd = params.conda_path ?: (detected_path ?: 'conda')
        } catch (Exception e) {
            conda.cmd = params.conda_path ?: 'conda'
        }
        process.conda = "${projectDir}/environment.yml" // Default env for all processes
    }
//    condamamba{
//        conda.enabled = true
//        conda.useMamba = true
//        conda.cmd = System.getenv('CONDA_EXE') ?: 'conda'
//        process.conda = "${projectDir}/environment.yml" // Default env for all processes
//    }
    // PROFILE: TEST
    // Uses the RABV small dataset for verification
    test {

       

    
        params {
            tax_id            = "11292"
            db_name           = "rabv-jul0425"
            
            is_segmented      = "N"
            extra_info_fill   = false
            publish_dir       = "${projectDir}/test_out/basic_test"
            
            // Dataset specific paths
            ref_list          = "${projectDir}/test_data/rabv_test_ref_list.txt"
            gene_info         = "${projectDir}/generic/rabv/Tables/gene_info.csv"
            test = "1"

            mmseqs_min_seq_id =  0.98
            mmseqs_threads = 4
            test_max_cluster_seqs = 250


        }
    }

    // PROFILE: SETUP / PRODUCTION
    // Configuration for the full setup or production run
    setup_rabv_full {
    
        params {
            tax_id            = "11292"
            db_name           = "rabv-jul0425"
            publish_dir       = "${projectDir}/test_out/rabv_test_full_run"
            
            is_segmented      = "N"
            extra_info_fill   = false
            
            // Dataset specific paths
            ref_list          = "${projectDir}/generic/rabv/ref_list.txt"
            gene_info         = "${projectDir}/generic/rabv/Tables/gene_info.csv"
            test = "0"
            mmseqs_min_seq_id =  0.98
        }
    }

    // PROFILE: SETUP / PRODUCTION
    // Configuration for the full setup or production run
    setup_rabv_test_update {
    
        params {
            tax_id            = "11292"
            db_name           = "rabv-jul0425"
            update            = '?'
            publish_dir       = "${projectDir}/test_out/rabv_test_update_run"
            
            is_segmented      = "N"
            extra_info_fill   = false
            
            // Dataset specific paths
            ref_list          = "${projectDir}/generic/rabv/ref_list.txt"
            gene_info         = "${projectDir}/generic/rabv/Tables/gene_info.csv"
            test = "0"
            mmseqs_min_seq_id =  0.98
        }
    }

    segmented_test {
        params {
            // Core Identity
            tax_id            = "11320"
            db_name           = "iav-db" // Inferred name
            is_segmented      = "Y"
            is_flu            = "Y"
            extra_info_fill   = false // Not used in flu script
            test              = "1"

            
            
            // Input Files (Relative to project root as per shell script)
            ref_list          = "${projectDir}/generic/influenza/ref_list_refmast.txt"
            gene_info         = "${projectDir}/generic/influenza/Tables/gene_info.tsv"
            
            //unimplemented thus far
            // ref_seq_seg       = "${projectDir}/generic-influenza/ref_seq_seg.tsv"
            
            // ref_seq_fna       = "${projectDir}/generic-influenza/ref_seq.fna"
            // exclusion_list    = "${projectDir}/generic-influenza/exclusion_list.tsv"
            // length_threshold  = "${projectDir}/generic-influenza/length_threshold.tsv"
            
            // Reference Directories for Alignment
            // ref_set_split     = "${projectDir}/generic-influenza/ref_set_split/"
            // ref_set_aligned   = "${projectDir}/generic-influenza/ref_set_aligned/"
            
            // Specific Flags
            // genbank_divisions = "PAT SYN" // For FilterAndExtractSequences
            
            // Output
            publish_dir       = "${projectDir}/test_out/IAV_DB"
            mmseqs_min_seq_id = 0.98
            test_max_cluster_seqs = 120
            
        }
    }


    flu_gisaid_test {
        params {
            // Core Identity
            tax_id            = "11320"
            db_name           = "iav-db" // Inferred name
            is_segmented      = "Y"
            is_flu            = "Y"
            extra_info_fill   = false 
            test              = "1"

            // Input Files
            ref_list          = "${projectDir}/generic/influenza/ref_list_refmast.txt"
            gene_info         = "${projectDir}/generic/influenza/Tables/gene_info.tsv"
            
            // GISAID specific
            gisaid_dir        = "${projectDir}/test_data/gisaid_data"

            // Output
            publish_dir       = "${projectDir}/test_out/IAV_DB_GISAID_TEST"
            mmseqs_min_seq_id = 0.98
            test_max_cluster_seqs = 120
        }
    }

    HCV_test {
        params {
            tax_id            = "11103"
            db_name           = "HCV_OM_test"

            is_segmented      = "N"
            extra_info_fill   = false
            test              = "1"

            // Dataset specific paths
            ref_list          = "${projectDir}/generic/hcv/ref_list.txt"
            gene_info         = "${projectDir}/generic/hcv/Tables/gene_info.tsv"

            // Output
            publish_dir       = "${projectDir}/test_out/HCV_OM_test"
            mmseqs_min_seq_id = 0.98
            mmseqs_threads    = 8
            test_max_cluster_seqs = 120
        }
    }

    HCV_full {
        params {
            tax_id            = "11103"
            db_name           = "HCV_full"

            is_segmented      = "N"
            extra_info_fill   = false
            test              = "0"

            // Dataset specific paths
            ref_list          = "${projectDir}/generic/hcv/ref_list.txt"
            gene_info         = "${projectDir}/generic/hcv/Tables/gene_info.tsv"

            // Output
            publish_dir       = "${projectDir}/test_out/HCV_full"
            mmseqs_min_seq_id = 0.98
        }
    }

    flu_gisaid_xml_laura{
        params{
            xml_dir           = "${projectDir}/test_out/flu_genbank_xml"
            is_segmented      = "Y"
            test              = 0
            publish_dir       = "/home3/oml4h/RABV-gTK/test_out/IAV_DB_gisaid_inc_full" 
            gisaid_dir        = "/home4/lm305z/IAV_DB/flu_vgtk_integrations/tmp/gisaid-data/"
            scripts_dir       = "${projectDir}/RABV-gTK/scripts"
            mmseqs_min_seq_id = "0.97"
            ref_list          = "${projectDir}/generic/influenza/ref_list_refmast.txt"
            gene_info         = "${projectDir}/generic/influenza/Tables/gene_info.tsv"
            tax_id            = "11320"
            db_name           = "iav-db" 
            

        }
    }
    

}